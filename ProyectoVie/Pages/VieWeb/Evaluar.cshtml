@page
@model ProyectoVie.Pages.VieWeb.EvaluarModel
@{
    ViewData["Title"] = "Evaluación de Propuesta";
}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../css/menua.css" />
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600&display=swap" rel="stylesheet">
    <title>Evaluar Propuesta</title>
    <style>
        /* Añadir estilos para mejorar la visibilidad de la tabla */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        input[type="text"], input[type="number"] {
            width: 100%;
            box-sizing: border-box;
            padding: 6px;
        }

        /* Hacer el checkbox más grande */
        input[type="checkbox"] {
            width: 30px; /* Ajusta el tamaño del checkbox */
            height: 30px; /* Ajusta el tamaño del checkbox */
            margin: 0 auto; /* Centra el checkbox dentro de su contenedor */
            display: block; /* Asegura que se comporte como un bloque y ocupe todo el ancho disponible */
        }

        /* Hacer que la tabla sea scrolleable */
        .rubrica-container {
            max-height: 400px;
            overflow-y: auto;
        }

        /* Estilo para el total que no será editable */
        .total-input {
            background-color: #f9f9f9;
            text-align: center;
        }

        /* Estilo para el botón */
        .button-container {
            margin-top: 20px;
            text-align: center;
        }

        .complete-button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }

            .complete-button:hover {
                background-color: #45a049;
            }
    </style>
</head>
<body>
    <!-- Header general del sistema -->
    <header class="header">
        <a href="/">
            <img src="~/css/tec-logo.png" alt="Logo del Tecnológico de Costa Rica" class="tec-logo">
        </a>
        <a href="/VieWeb/MiPerfil">
            <img src="~/css/icons/perfil.svg" alt="Perfil" class="profile-pic" aria-label="Perfil">
        </a>
    </header>
    <!-- Sidebar izquierdo -->
    <div class="sidebar">
        <div class="option">
            <a href="/VieWeb/MenuAdmin">
                <img src="~/css/icons/propuesta.svg" alt="Propuestas" aria-label="Ir a las Propuestas">
            </a>
            <span>Propuestas</span>
        </div>
        <div class="option">
            <a href="/VieWeb/Graficos">
                <img src="~/css/icons/estadisticas.svg" alt="Estadísticas" aria-label="Ver Estadísticas">
            </a>
            <span>Estadísticas</span>
        </div>
        <div class="option">
            <a href="/VieWeb/Usuarios">
                <img src="~/css/icons/usuarios.svg" alt="Usuarios" aria-label="Administrar Usuarios">
            </a>
            <span>Usuarios</span>
        </div>
        <div class="exit-option">
            <a href="/VieWeb/Login">
                <img src="~/css/icons/salir.svg" alt="Salir" aria-label="Cerrar sesión">
            </a>
            <span>Salir</span>
        </div>
    </div>

    <!-- Contenido principal -->
    <div class="main-content">
        <h1>Evaluación de Propuesta</h1>
        <form method="post">

            <!-- Tabla de rúbrica -->
            <div class="rubrica-container">
                <table class="rubrica-table" role="table">
                    <thead>
                        <tr>
                            <th>VARIABLE</th>
                            <th>DESCRIPCIÓN DE LA VARIABLE</th>
                            <th>No cumple</th>
                            <th>Cumple parcial</th>
                            <th>Cumple</th>
                            <th>Comentario</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Afinidad de disciplinas</td>
                            <td>
                                El equipo de trabajo cumple con:<br>
                                a. Explica la articulación de las áreas de conocimiento participantes.<br>
                                b. Especifica la participación de cada integrante del equipo.<br>
                                c. Tiene una conformación interdisciplinaria.
                            </td>
                            <td>
                                <input type="checkbox" name="NoCumpleAfinidad" value="1" onclick="toggleCheckboxes(this)" aria-label="No cumple Afinidad">
                                <span id="porcentajeAyuda" style="font-size: 0.8em; text-align: center; display: block;">0%</span>
                            </td>
                            <td>
                                <input type="checkbox" name="CumpleParcialAfinidad" value="1" onclick="toggleCheckboxes(this)" aria-label="Cumple parcialmente Afinidad">
                                <span id="porcentajeAyuda" style="font-size: 0.8em; text-align: center; display: block;">5%</span>
                            </td>
                            <td>
                                <input type="checkbox" name="CumpleAfinidad" value="1" onclick="toggleCheckboxes(this)" aria-label="Cumple Afinidad">
                                <span id="porcentajeAyuda" style="font-size: 0.8em; text-align: center; display: block;">10%</span>
                            </td>
                            <td>
                                <input type="text" name="PorcentajeAfinidad" aria-describedby="porcentajeAyuda">
                            </td>
                        </tr>
                        <tr>
                            <td>El problema que aborda</td>
                            <td>
                                El problema que aborda cumple con:<br>
                                a. Se encuentra justificado con fuentes de información con referencias actualizadas y dentro de las políticas nacionales vigentes.<br>
                                b. Se vincula con los ejes del conocimiento estratégicos del ITCR.<br>
                                c. Hay explicación sobre su correspondencia con los ODS.
                            </td>
                            <td>
                                <input type="checkbox" name="NoCumpleProblema" value="1" onclick="toggleCheckboxes(this)" aria-label="No cumple Problema">
                                <span id="problemaAyuda" style="font-size: 0.8em; text-align: center; display: block;">0%</span>
                            </td>
                            <td>
                                <input type="checkbox" name="CumpleParcialProblema" value="1" onclick="toggleCheckboxes(this)" aria-label="Cumple parcialmente Problema">
                                <span id="problemaAyuda" style="font-size: 0.8em; text-align: center; display: block;">10%</span>
                            </td>
                            <td>
                                <input type="checkbox" name="CumpleProblema" value="1" onclick="toggleCheckboxes(this)" aria-label="Cumple Problema">
                                <span id="problemaAyuda" style="font-size: 0.8em; text-align: center; display: block;">20%</span>
                            </td>
                            <td>
                                <input type="text" name="PorcentajeProblema" aria-describedby="porcentajeAyuda">
                            </td>
                        </tr>
                        <tr>
                            <td>Estrategia de abordaje</td>
                            <td>
                                La estrategia de abordaje cumple con:<br>
                                a. Describe el proceso para la obtención de los resultados esperados.<br>
                                b. Especifica las metodologías y técnicas acorde al tipo de proyecto (extensión docente, transferencia tecnológica y acción participativa).<br>
                                c. Especifica la relación del eje de conocimiento y su propuesta.
                            </td>
                            <td>
                                <input type="checkbox" name="NoCumpleEstrategia" value="1" onclick="toggleCheckboxes(this)" aria-label="No cumple Estrategia">
                                <span id="estrategiaAyuda" style="font-size: 0.8em; text-align: center; display: block;">0%</span>
                            </td>
                            <td>
                                <input type="checkbox" name="CumpleParcialEstrategia" value="1" onclick="toggleCheckboxes(this)" aria-label="Cumple parcialmente Estrategia">
                                <span id="estrategiaAyuda" style="font-size: 0.8em; text-align: center; display: block;">10%</span>
                            </td>
                            <td>
                                <input type="checkbox" name="CumpleEstrategia" value="1" onclick="toggleCheckboxes(this)" aria-label="Cumple Estrategia">
                                <span id="estrategiaAyuda" style="font-size: 0.8em; text-align: center; display: block;">20%</span>
                            </td>
                            <td>
                                <input type="text" name="PorcentajeEstrategia" aria-describedby="porcentajeAyuda">
                            </td>
                        </tr>
                        <tr>
                            <td>Información técnica</td>
                            <td>
                                La información técnica cumple con:<br>
                                a. Los objetivos específicos tienen resultados esperados.<br>
                                b. Los objetivos específicos tienen actividades con indicadores y su respectivo medio de verificación.<br>
                                c. Cuenta con un cronograma.<br>
                                d. Presenta un análisis de los riesgos y mitigaciones.
                            </td>
                            <td>
                                <input type="checkbox" name="NoCumpleInformacion" value="1" onclick="toggleCheckboxes(this)" aria-label="No cumple Información">
                                <span id="informacionAyuda" style="font-size: 0.8em; text-align: center; display: block;">0%</span>
                            </td>
                            <td>
                                <input type="checkbox" name="CumpleParcialInformacion" value="1" onclick="toggleCheckboxes(this)" aria-label="Cumple parcialmente Información">
                                <span id="informacionAyuda" style="font-size: 0.8em; text-align: center; display: block;">10%</span>
                            </td>
                            <td>
                                <input type="checkbox" name="CumpleInformacion" value="1" onclick="toggleCheckboxes(this)" aria-label="Cumple Información">
                                <span id="informacionAyuda" style="font-size: 0.8em; text-align: center; display: block;">20%</span>
                            </td>
                            <td>
                                <input type="text" name="PorcentajeInformacion" aria-describedby="porcentajeAyuda">
                            </td>
                            </td>
                        </tr>
                        <tr>
                            <td>Viabilidad financiera</td>
                            <td>
                                En cuanto a los recursos cumple con:<br>
                                a. Están debidamente justificados.<br>
                                b. Se detallan ingresos y egresos.<br>
                                c. Hay una distribución de los recursos que responden a las actividades de proyecto.
                            </td>
                            <td>
                                <input type="checkbox" name="NoCumpleFinanciera" value="1" onclick="toggleCheckboxes(this)" aria-label="No cumple Viabilidad Financiera">
                                <span id="financieraAyuda" style="font-size: 0.8em; text-align: center; display: block;">0%</span>
                            </td>
                            <td>
                                <input type="checkbox" name="CumpleParcialFinanciera" value="1" onclick="toggleCheckboxes(this)" aria-label="Cumple parcialmente Viabilidad Financiera">
                                <span id="financieraAyuda" style="font-size: 0.8em; text-align: center; display: block;">10%</span>
                            </td>
                            <td>
                                <input type="checkbox" name="CumpleFinanciera" value="1" onclick="toggleCheckboxes(this)" aria-label="Cumple Viabilidad Financiera">
                                <span id="financieraAyuda" style="font-size: 0.8em; text-align: center; display: block;">20%</span>
                            </td>
                            <td>
                                <input type="text" name="PorcentajeFinanciera" aria-describedby="porcentajeAyuda">
                            </td>
                        </tr>
                        <tr>
                            <td>Participación</td>
                            <td>
                                La participación cumple con:<br>
                                a. Tiene el respaldo de los actores participantes.<br>
                                b. Están debidamente justificados.<br>
                                c. Está acorde al tipo de intervención.
                            </td>
                            <td>
                                <input type="checkbox" name="NoCumpleParticipacion" value="1" onclick="toggleCheckboxes(this)" aria-label="No cumple Participación">
                                <span id="participacionAyuda" style="font-size: 0.8em; text-align: center; display: block;">0%</span>
                            </td>
                            <td>
                                <input type="checkbox" name="CumpleParcialParticipacion" value="1" onclick="toggleCheckboxes(this)" aria-label="Cumple parcialmente Participación">
                                <span id="participacionAyuda" style="font-size: 0.8em; text-align: center; display: block;">5%</span>
                            </td>
                            <td>
                                <input type="checkbox" name="CumpleParticipacion" value="1" onclick="toggleCheckboxes(this)" aria-label="Cumple Participación">
                                <span id="participacionAyuda" style="font-size: 0.8em; text-align: center; display: block;">10%</span>
                            </td>
                            <td>
                                <input type="text" name="PorcentajeParticipacion" aria-describedby="porcentajeAyuda">
                            </td>
                        </tr>
                        <tr>
                            <td class="total-input"><strong>Total</strong></td>
                            <td colspan="5">
                                <input type="text" name="PorcentajeTotal" class="total-input" aria-label="Porcentaje total" readonly>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Botón para completar la evaluación -->
            <div class="button-container">
                <input type="hidden" name="PropuestaId" value="@Model.PropuestaId" />
                <button type="submit" class="complete-button" aria-label="Completar evaluación">Completar Evaluación</button>
            </div>

        </form>

        <!-- Mensaje de advertencia -->
        <div id="warning-message" class="warning-message" role="alert"></div>
    </div>

    <script>
        function toggleCheckboxes(currentCheckbox) {
            const row = currentCheckbox.closest('tr');
            const checkboxes = row.querySelectorAll('input[type="checkbox"]');

            checkboxes.forEach(checkbox => {
                if (checkbox !== currentCheckbox) {
                    checkbox.checked = false;
                }
            });

            calculateTotal();
        }

        function calculateTotal() {
            let total = 0;
            let warningMessage = '';


            // Sumar valores de los checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                if (checkbox.checked) {
                    if (checkbox.name.includes("NoCumple")) {
                        total += 0;
                    }
                    else if (checkbox.name.includes("CumpleParcial")) {
                        if (checkbox.name === "CumpleParcialAfinidad" || checkbox.name === "CumpleParcialParticipacion") {
                            total += 5;
                        } else {
                            total += 10;
                        }
                    }
                    else if (checkbox.name.includes("Cumple")) {
                        if (checkbox.name === "CumpleAfinidad" || checkbox.name === "CumpleParticipacion") {
                            total += 10;
                        } else {
                            total += 20;
                        }
                    }
                }

            });

            document.querySelector('input[name="PorcentajeTotal"]').value = total;

            const warningDiv = document.getElementById('warning-message');
            if (warningMessage) {
                warningDiv.textContent = warningMessage;
                warningDiv.style.display = 'block';
            } else {
                warningDiv.style.display = 'none';
            }
        }
    </script>

</body>
</html>